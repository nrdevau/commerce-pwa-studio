"use strict";(self.webpackChunkcommerce_pwa_studio=self.webpackChunkcommerce_pwa_studio||[]).push([[2190],{26978:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return p},default:function(){return c}});var o,a=t(87462),i=t(63366),r=(t(15007),t(64983)),d=t(91515),l=["components"],p={},m=(o="InlineAlert",function(e){return console.warn("Component "+o+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)}),s={_frontmatter:p},u=d.Z;function c(e){var n=e.components,t=(0,i.Z)(e,l);return(0,r.mdx)(u,(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"configure-webpack"},"Configure Webpack"),(0,r.mdx)("p",null,"Use the ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," tool to make further modifications to PWA Studio's default Webpack configuration."),(0,r.mdx)("h2",{id:"configurewebpackoptions"},(0,r.mdx)("inlineCode",{parentName:"h2"},"configureWebpack(options)")),(0,r.mdx)("p",null,"A function that returns a Webpack configuration object."),(0,r.mdx)("p",null,"Import and call ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," in your project's ",(0,r.mdx)("inlineCode",{parentName:"p"},"webpack.config.js")," file to generate a Webpack configuration object suited to your PWA Studio project and its dependencies."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Returns:"),"\nA ",(0,r.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"},"Promise")," that resolves to a configuration object for webpack."),(0,r.mdx)("p",null,"The generated configuration object tells Webpack how to process the project's source code and generate bundles.\nIt is a ",(0,r.mdx)("a",{parentName:"p",href:"https://webpack.js.org/configuration/"},"complete Webpack configuration object")," that is ready for immediate use."),(0,r.mdx)("p",null,"You can also modify it in your ",(0,r.mdx)("inlineCode",{parentName:"p"},"webpack.config.js")," before returning it out of your own configure function."),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," is asynchronous.\nWebpack accepts a Promise for a configuration, so\nyou can return the result of ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack")," directly out of the exported function in ",(0,r.mdx)("inlineCode",{parentName:"p"},"webpack.config.js"),".\nIf you want to modify the configuration, you must use ",(0,r.mdx)("inlineCode",{parentName:"p"},"await"),"."),(0,r.mdx)("h3",{id:"parameters"},"Parameters"),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Name"),(0,r.mdx)("th",{parentName:"tr",align:null},"Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"options")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"Object")),(0,r.mdx)("td",{parentName:"tr",align:null},"Options for generating the configuration object")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"options.context")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"String")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("em",{parentName:"td"},"Required.")," The path of the project root directory")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"options.vendor")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"String[]")),(0,r.mdx)("td",{parentName:"tr",align:null},'A list of module names to force Webpack to include in a "commons" bundle')),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"options.special")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"Object")),(0,r.mdx)("td",{parentName:"tr",align:null},"An object that maps module names to a set of configuration.")))),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"To make your project performant, limit the ",(0,r.mdx)("inlineCode",{parentName:"p"},"options.vendor")," list to strictly necessary dependencies required by most or all modules."),(0,r.mdx)("h3",{id:"special-flags"},"Special flags"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"options.special")," parameter tells ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," to create special configurations for specific modules."),(0,r.mdx)("p",null,"By default, Webpack treats the source code of your project very differently than the dependency code.\nWebpack does so because public NPM modules are not reliably compatible with advanced JavaScript features.\nDevelopers get around this by customizing the Webpack configuration rules."),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," offers a simple API: for each module you want to treat special, add these named flags.\nIt will adjust Webpack configuration to run that module and its files through additional build steps."),(0,r.mdx)("h4",{id:"esmodules-flag"},(0,r.mdx)("inlineCode",{parentName:"h4"},"esModules")," flag"),(0,r.mdx)("p",null,"If ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," generates the configuration for processing ",(0,r.mdx)("inlineCode",{parentName:"p"},".js")," files from the named module as ES Modules.\nThis allows Webpack to use advanced optimizations on them, but\nit may fail if the module contains noncompliant code."),(0,r.mdx)("h4",{id:"cssmodules-flag"},(0,r.mdx)("inlineCode",{parentName:"h4"},"cssModules")," flag"),(0,r.mdx)("p",null,"If ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," generates the configuration for processing ",(0,r.mdx)("inlineCode",{parentName:"p"},".css")," files from the named module as CSS Modules.\nThis allows Webpack to maintain a separate namespace for every CSS Module, including modules inside dependencies."),(0,r.mdx)("p",null,"This prevents style collisions between sibling modules, but\nit may fail if the module does not actually use CSS Module patterns."),(0,r.mdx)("h4",{id:"graphqlqueries-flag"},(0,r.mdx)("inlineCode",{parentName:"h4"},"graphqlQueries")," flag"),(0,r.mdx)("p",null,"If ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," generates the configuration that tells webpack to look for ",(0,r.mdx)("inlineCode",{parentName:"p"},".graphql")," files in the dependency and precompile them for better performance."),(0,r.mdx)("p",null,"All GraphQL query files in all modules will appear in the GraphQL playground, but\nthis setting allows you to choose which dependencies have queries you want to debug."),(0,r.mdx)("h4",{id:"rootcomponents-flag"},(0,r.mdx)("inlineCode",{parentName:"h4"},"rootComponents")," flag"),(0,r.mdx)("p",null,"If ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," generates the configuration that tells webpack to look for RootComponent files in a module's ",(0,r.mdx)("inlineCode",{parentName:"p"},"src/RootComponents")," or ",(0,r.mdx)("inlineCode",{parentName:"p"},"RootComponents")," subdirectories."),(0,r.mdx)("p",null,"This allows a third-party dependency to provide RootComponents to your app automatically, but\nit may slow down the build if you add too many modules that do not have RootComponents."),(0,r.mdx)("h4",{id:"upward-flag"},(0,r.mdx)("inlineCode",{parentName:"h4"},"upward")," flag"),(0,r.mdx)("p",null,"If ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack()")," generates the configuration that tells weback to look for an ",(0,r.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file in a module's root directory and merge it with the project's root ",(0,r.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file."),(0,r.mdx)("p",null,"This lets third-party dependencies contribute to UPWARD behavior, but\nit may cause collisions or merge problems if the UPWARD files contradict each other."),(0,r.mdx)("h2",{id:"example"},"Example"),(0,r.mdx)("p",null,"The following example is taken from ",(0,r.mdx)("inlineCode",{parentName:"p"},"packages/venia-concept/webpack.config.js"),".\nIt represents a typical setup using ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack")," to generate Webpack config.\nIt also demonstrates that ",(0,r.mdx)("inlineCode",{parentName:"p"},"configureWebpack")," returns a recognizable Webpack object, which you can modify."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},"const { configureWebpack } = require('@magento/pwa-buildpack');\n\nmodule.exports = async env => {\n    const config = await configureWebpack({\n        context: __dirname,\n        vendor: [\n            '@apollo/client',\n            'apollo-cache-persist',\n            'informed',\n            'react',\n            'react-dom',\n            'react-feather',\n            'react-redux',\n            'react-router-dom',\n            'redux',\n            'redux-actions',\n            'redux-thunk'\n        ],\n        special: {\n            // Treat code originating in the `@magento/peregrine` module\n            // as ES Modules, just like the project source itself.\n            '@magento/peregrine': {\n                esModules: true\n            }\n            // Treat code originating in the `@magento/venia-ui` as though\n            // it uses ES Modules, CSS Modules, GraphQL queries, RootComponents,\n            // and UPWARD definitions. This is the right set of flags for a UI\n            // library that makes up the bulk of your project.\n            '@magento/venia-ui': {\n                cssModules: true,\n                esModules: true,\n                graphqlQueries: true,\n                rootComponents: true,\n                upward: true\n            }\n        },\n        env\n    });\n\n    // configureWebpack() returns a regular Webpack configuration object.\n    // You can customize the build by mutating the object here, as in\n    // this example:\n    config.module.noParse = [/braintree\\-web\\-drop\\-in/];\n    // Since it's a regular Webpack configuration, the object supports the\n    // `module.noParse` option in Webpack, documented here:\n    // https://webpack.js.org/configuration/module/#modulenoparse\n\n    return config;\n};\n")))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-api-buildpack-webpack-configure-index-md-2916eab508d43ffc2a52.js.map